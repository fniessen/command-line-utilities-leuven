#!/usr/bin/env bash

# Find all files in the current directory and its subdirectories that contain
# Windows-style line endings (CRLF), and then converts them to Unix-style line
# endings (LF).

# Find all files in the current directory and its subdirectories that contain
# CRLF line endings.
files_with_crlf=$(find . -type f -exec file {} \; | grep "CRLF" | awk -F ':' '{ print $1 }')

# If there are no files with CRLF line endings, exit the script.
if [ -z "$files_with_crlf" ]; then
    echo "No files with CRLF line endings found."
    exit 0
fi

# Ask for confirmation before converting the files.
echo "The following files have CRLF line endings:"
echo "$files_with_crlf"
echo "Do you want to convert files with CRLF line endings to LF line endings? (y/N)"
read -p "> " confirm
echo "-------------------------"

if [ "$confirm" != "y" ] && [ "$confirm" != "Y" ]; then
    echo "Conversion cancelled."
    exit 0
fi

# Convert all files with CRLF line endings to LF line endings
echo "Converting CRLF line endings to LF for the following files: "
echo "$files_with_crlf"
echo "-------------------------"

echo "$files_with_crlf" | xargs -I {} flip -u {}

echo "-------------------------"
echo "Conversion complete."
