#!/usr/bin/env bash

# Remove the "Zone.Identifier" alternate data stream (ADS) from files within the
# specified directory and its subdirectories.

# Directory path where Zone.Identifier files will be removed.
directory_path="."

# Check if the directory exists.
if [ ! -d "$directory_path" ]; then
    echo "Error: Directory does not exist: $directory_path"
    exit 1
fi

# Check if getfattr command is available.
if ! command -v getfattr &> /dev/null; then
    printf "Error: 'getfattr' command not found. Please install the 'attr' package.\n"
    exit 2
fi

# Function to identify files ending with ":Zone.Identifier".
find_files_to_remove() {
    find "$directory_path" -type f -name "*:Zone.Identifier"
}

# Function to remove files ending with ":Zone.Identifier".
remove_zone_identifier_files() {
    local files=$(find_files_to_remove)
    for file in $files; do
        if [ -e "$file" ]; then
            rm "$file"
            echo "Removed $file"
        fi
    done
}

# Main script execution.
remove_zone_identifier_files
echo "Script execution complete."
