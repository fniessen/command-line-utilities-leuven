#!/usr/bin/env bash

# Remove files ending with ":Zone.Identifier" within the specified directory
# and its subdirectories. These files are typically associated with Alternate
# Data Streams (ADS) on Windows file systems.

# Directory path where Zone.Identifier files will be removed.
directory_path="."

# Check if the directory exists.
if [[ ! -d "$directory_path" ]]; then
    echo "Error: Directory does not exist: $directory_path"
    exit 1
fi

# Check if getfattr command is available.
if ! command -v getfattr &> /dev/null; then
    printf "Error: 'getfattr' command not found. Please install the 'attr' package.\n"
    exit 2
fi

# Function to remove files ending with ":Zone.Identifier".
remove_zone_identifier_files() {
    find "$directory_path" -type f -name "*:Zone.Identifier" -print0 \
        | while IFS= read -r -d '' file; do
              if [[ -e "$file" ]]; then
                  rm "$file"
                  echo "Removed $file"
              fi
          done
}

# Main script execution.
remove_zone_identifier_files
echo "Script execution complete."
