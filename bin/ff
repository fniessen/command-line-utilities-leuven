#!/usr/bin/env sh
#
# ff - find files matching a string and print their full file name

usage() {
    cat <<-EOF
	Usage: ff [PATTERN]

	Find files matching a string and print their full file name.

	Options:
	-h, --help                   display this help and exit

	Examples:
	  ff                         list all files
	  ff core                    find files matching core in their file name
EOF
}

invalid() {
    echo "$SELF: invalid option '$1'" > /dev/stderr
    usage
    exit 1
}

SELF="${0##*/}"

yellow="$(tput setaf 3)"
blue="$(tput setaf 4)"
reset="$(tput sgr0)"

C_DIR="1;34"
C_PAT="1;33;1;44"
C_RST="0"

# Parse options.
while [ "$#" -gt 0 ]; do
    case "$1" in
        -h | --help) usage;        exit 0 ;;
        --)          shift;        break ;;
        -*)          invalid "$1"; break ;;
        *)                         break ;;
    esac
    shift
done

PATTERN="$1"

stdbuf -oL find . -type f -iname "*$PATTERN*" -printf '%P\n' \
    | GREP_COLORS="sl=$C_DIR:mt=$C_RST" stdbuf -oL grep --color=always '[^/]*$' \
    | GREP_COLORS="sl=$C_RST"           stdbuf -oL grep --color=always -iP "$PATTERN(?=[^/]*$)" \
    | GREP_COLORS="sl=$C_DIR:mt=$C_PAT"            grep -i "$PATTERN" --color=always
